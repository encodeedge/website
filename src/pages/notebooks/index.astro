---
import { Background } from '@/components/background';
import DefaultLayout from '@/layouts/DefaultLayout.astro';
import { Badge } from "@/components/ui/badge";

const notebooks = await Astro.glob<any>('./*.astro');
const filteredNotebooks = notebooks
  .filter((n) => !n.file.endsWith('index.astro'))
  .map((n) => {
    const frontmatter = n.frontmatter || n;
    const url = n.url;
    const slug = url?.split('/').filter(Boolean).pop() || '';
    const title = frontmatter?.title || slug
      .split('-')
      .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
      .join(' ');

    return {
      title,
      description: frontmatter?.description || '',
      image: frontmatter?.image,
      tags: Array.isArray(frontmatter?.tags) ? frontmatter.tags : [],
      topics: Array.isArray(frontmatter?.topics) ? frontmatter.topics : [],
      authorName: frontmatter?.authorName,
      authorImage: frontmatter?.authorImage,
      url,
    };
  });
---

<DefaultLayout title="Notebooks" description="Index of all notebooks">
	<Background>
		<div class="py-28 lg:pt-44 lg:pb-32">
			<section>
				<div class="container max-w-5xl space-y-4 text-center">
					<h1 class="text-2xl font-semibold tracking-tight md:text-4xl lg:text-5xl">
						Notebooks
					</h1>

					<p class="text-muted-foreground max-w-md leading-snug font-medium lg:mx-auto">
						Explore our collection of notebooks.
					</p>
				</div>
			</section>
			<div class="container max-w-5xl mt-12">
				<div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
					{filteredNotebooks.map((notebook) => (
						<div class="rounded-xl border hover:shadow-lg transition-shadow duration-300 block">
							<a href={notebook.url} class="block">
								<div class="p-2">
									{notebook.image ? (
										<img
											src={notebook.image}
											alt={`Hero image for ${notebook.title}`}
											class="aspect-video w-full rounded-lg object-cover"
										/>
									) : (
										<div class="aspect-video w-full rounded-lg bg-muted flex items-center justify-center text-muted-foreground">
											<span class="text-sm">No Image</span>
										</div>
									)}
								</div>
								<div class="px-3 pt-2 pb-4">
									<h2 class="mb-1 font-semibold">{notebook.title}</h2>
									{notebook.description && <p class="text-muted-foreground line-clamp-2 text-sm">{notebook.description}</p>}
								</div>
							</a>

							<div class="px-3 pb-4 -mt-2 space-y-3">
								{notebook.authorName && (
									<a href={`/authors/${notebook.authorName.toLowerCase().replace(/\s+/g, '-')}`} class="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors font-medium w-fit">
										{notebook.authorImage ? (
											<img src={notebook.authorImage} alt={notebook.authorName} class="h-6 w-6 rounded-full border object-cover" />
										) : (
											<div class="h-6 w-6 rounded-full bg-muted flex items-center justify-center text-[10px] font-bold text-muted-foreground">
												{notebook.authorName.charAt(0)}
											</div>
										)}
										{notebook.authorName}
									</a>
								)}

								{(notebook.tags?.length > 0 || notebook.topics?.length > 0) && (
									<div class="flex flex-wrap gap-1.5">
										{notebook.tags.slice(0, 3).map((tag: string) => (
											<a href={`/tags/${tag}`}><Badge variant="secondary" className="text-xs bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors cursor-pointer">{tag}</Badge></a>
										))}
										{notebook.topics.slice(0, 3).map((topic: string) => (
											<a href={`/topics/${topic}`}><Badge variant="outline" className="text-xs border-blue-200 text-blue-700 hover:bg-blue-50 transition-colors cursor-pointer">{topic}</Badge></a>
										))}
									</div>
								)}
							</div>
						</div>
					))}
				</div>
			</div>
		</div>
	</Background>
</DefaultLayout>
